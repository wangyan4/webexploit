import React, { Component } from 'react'
import {Link} from 'react-router-dom'

export default class All extends Component {
  constructor() {
    super();
    this.state = {
      data: []
    }
  }
  componentDidMount() {
    let page = this.props.match.params.page;
    let url_api = `https://cnodejs.org/api/v1/topics?tab=all&page=${page || 1}`;
    let obj = {
      method: "get"
    }
    fetch(url_api, obj)
      .then((res) => res.json())
      .then((data) => {
        this.setState({
          data: data.data
        })
      })
  }
  componentDidUpdate(prevProps, prevStates) {
    if (prevProps.match.params.page !== this.props.match.params.page) {
      let page = this.props.match.params.page;
      let url_api = `https://cnodejs.org/api/v1/topics?tab=all&page=${page || 1}`;
      let obj = {
        method: "get"
      }
      fetch(url_api, obj)
        .then((res) => res.json())
        .then((data) => {
          this.setState({
            data: data.data
          })
        })
    }

  }
  formatMsgTime = (timespan) => {
    var dateTime = new Date(timespan);
    var year = dateTime.getFullYear();
    var month = dateTime.getMonth() + 1;
    var day = dateTime.getDate();
    var hour = dateTime.getHours();
    var minute = dateTime.getMinutes();
    var now = new Date();
    var now_new = Date.parse(now.toDateString());

    var milliseconds = 0;
    var timeSpanStr = '一年前';
    milliseconds = now_new - Date.parse(dateTime);

    if (milliseconds <= 1000 * 60 * 1) {
      timeSpanStr = '刚刚';
    }
    else if (1000 * 60 * 1 < milliseconds && milliseconds <= 1000 * 60 * 60) {
      timeSpanStr = Math.round((milliseconds / (1000 * 60))) + '分钟前';
    }
    else if (1000 * 60 * 60 * 1 < milliseconds && milliseconds <= 1000 * 60 * 60 * 24) {
      timeSpanStr = Math.round(milliseconds / (1000 * 60 * 60)) + '小时前';
    }
    else if (1000 * 60 * 60 * 24 < milliseconds && milliseconds <= 1000 * 60 * 60 * 24 * 15) {
      timeSpanStr = Math.round(milliseconds / (1000 * 60 * 60 * 24)) + '天前';
    }
    else if (milliseconds > 1000 * 60 * 60 * 24 * 15 && year === now.getFullYear()) {
      timeSpanStr = month + '-' + day + ' ' + hour + ':' + minute;
    } else {
      timeSpanStr = year + '-' + month + '-' + day + ' ' + hour + ':' + minute;
    }
    return timeSpanStr;
  }
  render() {
    let { url } = this.props.match;
    console.log(url);
    url = url.slice(0, 5);
    return (
      <div className="leftContent">
        {
          this.state.data.map((item) => {
            return (
              <div key={item.id}>
                <div className="leftList">
                  <span>
                    <img src={`${item.author.avatar_url}`} alt="" />
                    <span>{item.reply_count}</span>
                    <span>/</span>
                    <span className="spmargin">{item.visit_count}</span>
                  </span>
                  <span>
                    <span>置顶</span>
                    <span>
                      <Link to={`${url}/content/${item.id}`}>{item.title}</Link>
                      <span>{this.formatMsgTime(item.last_reply_at)}</span>
                    </span>
                  </span>
                </div>
              </div>
            )
          })
        }
        <div>
          <ul className="bottomList">
            {
              [1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map((item) => {
                return (
                  <li key={item}><Link to={`${url}/all/${item}`}>{item}</Link></li>
                )
              })
            }
          </ul>
        </div>
      </div>
    )
  }
};



